{"version":3,"file":"alpine-ajax.js","sources":["../src/utils/request.js","../src/utils/submitter-polyfill.js","../src/index.js","../builds/cdn.js"],"sourcesContent":["export function request(method, url, data, options) {\n\n  if (method === 'GET') {\n    let params = Array.from(data.entries())\n      .filter(([key, value]) => value !== '' || value !== null)\n    if (params.length) {\n      let splitUrl = url.split('#')\n      let anchor = splitUrl[1]\n      url = splitUrl[0]\n      if (url.includes('?')) {\n          url += '?'\n      } else {\n          url += '&'\n      }\n      url += new URLSearchParams(params)\n      if (anchor) {\n          url += '#' + anchor\n      }\n    }\n    data = null\n  }\n\n  return new Promise((resolve, reject) => {\n    let xhr = new XMLHttpRequest()\n    xhr.open(method, url)\n    xhr.overrideMimeType('text/html')\n\n    let headers = Object.assign({\n      'X-Alpine-Request': 'true',\n    }, options.headers)\n\n    for (const [key, value] of Object.entries(headers)) {\n      xhr.setRequestHeader(key, value)\n    }\n\n    if (options.progress && xhr.upload) {\n      xhr.upload.addEventListener('progress', options.progress)\n    }\n\n    let info = { xhr, url, data, options }\n\n    xhr.onload = function () {\n      if (this.status >= 200 && this.status < 400) return resolve(xhr.response)\n\n      reject(info)\n    }\n\n    xhr.onerror = function () {\n      reject(info)\n    }\n\n    xhr.send(data)\n  })\n}\n","/*\n * SubmitEvent API Submitter Polyfill\n * https://stackoverflow.com/a/61110260\n */\n\n!function(){\n  var lastBtn = null\n  document.addEventListener('click',function(e){\n      if (!e.target.closest) return;\n      lastBtn = e.target.closest('button, input[type=submit]');\n  }, true);\n  document.addEventListener('submit',function(e){\n      if ('submitter' in e) return;\n      var canditates = [document.activeElement, lastBtn];\n      lastBtn = null;\n      for (var i=0; i < canditates.length; i++) {\n          var candidate = canditates[i];\n          if (!candidate) continue;\n          if (!candidate.form) continue;\n          if (!candidate.matches('button, input[type=button], input[type=image]')) continue;\n          e.submitter = candidate;\n          return;\n      }\n      e.submitter = e.target.querySelector('button, input[type=button], input[type=image]')\n  }, true);\n}();\n","import { request } from './utils/request'\nimport './utils/submitter-polyfill'\n\nexport default function (Alpine) {\n  Alpine.addRootSelector(() => '[x-ajax]')\n\n  Alpine.directive('ajax', (el, values, { cleanup }) => {\n    let listeners = (['click', 'submit']).map(event => listenForAjaxEvent(el, event))\n\n    cleanup(() => {\n      listeners.forEach(remove => remove())\n    })\n  })\n}\n\nfunction listenForAjaxEvent(el, name) {\n  let handler = event => {\n    let source = getSourceElement(event.target, name)\n    if (! isValidSourceElement(source)) return\n    event.stopPropagation()\n    event.preventDefault()\n    let ids = el.getAttribute('x-ajax')\n    ids = ids ? ids.split(',') : [el.id]\n    let targets = ids.map(id => {\n      let element = document.getElementById(id)\n      if (! element) {\n        throw Error('Target with ID `' + id + '` not found.')\n      }\n\n      return element\n    })\n\n    makeAjaxRequest(source, targets, event)\n  }\n\n  el.addEventListener(name, handler)\n\n  return () => {\n    el.removeEventListener(name, handler)\n  }\n}\n\nfunction getSourceElement(trigger, event) {\n  let validTag = {\n    submit: 'FORM',\n    click: 'A',\n  }\n\n  return trigger.closest(validTag[event])\n}\n\nfunction isValidSourceElement(el) {\n  if (! el) return false\n  let root = el.closest('[x-ajax],[ajax-ignore]')\n  if (root.hasAttribute('ajax-ignore')) return false\n  return el.tagName === 'FORM' ? true : isLocalLink(el);\n}\n\nasync function makeAjaxRequest(el, targets, event) {\n  if (el.hasAttribute('ajax-confirm') && !confirm(el.getAttribute('ajax-confirm'))) return;\n\n  dispatch(el, 'ajax:before')\n\n  try {\n    let fragment = await requestFragment(requestOptions(el, event))\n    targets.forEach(target => target.replaceWith(fragment?.getElementById(target.id) ?? ''))\n    dispatch(el, 'ajax:success')\n  } catch (error) {\n    dispatch(el, 'ajax:error', error)\n  }\n\n  dispatch(el, 'ajax:after')\n}\n\nfunction dispatch(el, name, detail = {}) {\n  el.dispatchEvent(\n      new CustomEvent(name, {\n          detail,\n          bubbles: true,\n          composed: true,\n          cancelable: true,\n      })\n  )\n}\n\nfunction requestOptions(el, event) {\n  let defaults = {\n    action: window.location.href,\n    method: 'GET',\n  }\n\n  let data = el.tagName === 'FORM' ? new FormData(el) : new FormData()\n  if (event.submitter?.name) {\n    data.append(event.submitter.name, event.submitter.value)\n  }\n\n  return {\n    data,\n    action: el.getAttribute(isLocalLink(el) ? 'href' : 'action') || defaults.action,\n    method: (el.getAttribute('method') || defaults.method).toUpperCase(),\n  }\n}\n\nfunction isLocalLink(el) {\n  return el.tagName === 'A' &&\n    location.hostname === el.hostname &&\n    el.getAttribute('href') &&\n    el.getAttribute('href').indexOf(\"#\") !== 0\n}\n\nasync function requestFragment(options) {\n  let response = ''\n  try {\n    response = await request(options.method, options.action, options.data, options)\n  } catch (response) {\n    throw Error(response.xhr.statusText)\n  }\n\n  return htmlToFragment(response)\n}\n\nfunction htmlToFragment(html) {\n  return document.createRange().createContextualFragment(html);\n}\n","import ajax from '../src/index'\n\ndocument.addEventListener('alpine:initializing', () => {\n    ajax(window.Alpine)\n})\n"],"names":["request","method","url","data","options","params","Array","from","entries","filter","key","value","length","splitUrl","split","anchor","includes","URLSearchParams","Promise","resolve","reject","xhr","XMLHttpRequest","open","overrideMimeType","headers","Object","assign","setRequestHeader","progress","upload","addEventListener","info","onload","status","response","onerror","send","lastBtn","document","e","target","closest","canditates","activeElement","i","candidate","form","matches","submitter","querySelector","Alpine","addRootSelector","directive","el","values","cleanup","listeners","map","event","listenForAjaxEvent","forEach","remove","name","handler","source","getSourceElement","isValidSourceElement","stopPropagation","preventDefault","ids","getAttribute","id","targets","element","getElementById","Error","makeAjaxRequest","removeEventListener","trigger","validTag","submit","click","root","hasAttribute","tagName","isLocalLink","confirm","dispatch","fragment","requestFragment","requestOptions","replaceWith","error","detail","dispatchEvent","CustomEvent","bubbles","composed","cancelable","defaults","action","window","location","href","FormData","append","toUpperCase","hostname","indexOf","statusText","htmlToFragment","html","createRange","createContextualFragment","ajax"],"mappings":"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"}