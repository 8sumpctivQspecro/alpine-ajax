{"version":3,"file":"alpine-ajax.js","sources":["../src/utils/request.js","../src/index.js","../builds/cdn.js"],"sourcesContent":["export function request(method, url, data, options) {\n\n  if (method === 'GET') {\n    let params = Array.from(data.entries())\n      .filter(([key, value]) => value !== '' || value !== null)\n    if (params.length) {\n      let splitUrl = url.split('#')\n      let anchor = splitUrl[1]\n      url = splitUrl[0]\n      if (url.includes('?')) {\n          url += '?'\n      } else {\n          url += '&'\n      }\n      url += new URLSearchParams(params)\n      if (anchor) {\n          url += '#' + anchor\n      }\n    }\n    data = null\n  }\n\n  return new Promise((resolve, reject) => {\n    let xhr = new XMLHttpRequest()\n    xhr.open(method, url)\n    xhr.overrideMimeType('text/html')\n\n    let headers = Object.assign({\n      'X-Requested-With': 'XMLHttpRequest',\n      'X-Alpine-Request': 'true',\n    }, options.headers)\n\n    for (const [key, value] of Object.entries(headers)) {\n      xhr.setRequestHeader(key, value)\n    }\n\n    if (options.progress && xhr.upload) {\n      xhr.upload.addEventListener('progress', options.progress)\n    }\n\n    let info = { xhr, url, data, options }\n\n    xhr.onload = function () {\n      if (this.status >= 200 && this.status < 400) return resolve(xhr.response)\n\n      reject(info)\n    }\n\n    xhr.onerror = function () {\n      reject(info)\n    }\n\n    xhr.send(data)\n  })\n}\n","import { request } from './utils/request'\n\nexport default function (Alpine) {\n  Alpine.addRootSelector(() => '[x-ajax]')\n\n  Alpine.directive('ajax', (el, { expression }, { cleanup }) => {\n    let target = expression ? document.getElementById(expression) : el\n    if (! target?.id) {\n      throw Error('You must specify an AJAX target with an ID.')\n    }\n\n    let listeners = (['click', 'submit']).map(event => listenForAjaxEvent(el, event, target))\n\n    cleanup(() => {\n      listeners.forEach(remove => remove())\n    })\n  })\n}\n\nfunction listenForAjaxEvent(el, name, target) {\n  let handler = event => {\n    let source = getSourceElement(event.target, name)\n    if (! isValidSourceElement(source)) return\n    event.preventDefault()\n    makeAjaxRequest(source, target)\n  }\n\n  el.addEventListener(name, handler)\n\n  return () => {\n    el.removeEventListener(name, handler)\n  }\n}\n\nfunction getSourceElement(trigger, event) {\n  let validTag = {\n    submit: 'FORM',\n    click: 'A',\n  }\n\n  return trigger.closest(validTag[event])\n}\n\nfunction isValidSourceElement(el) {\n  if (! el) return false\n  let root = el.closest('[x-ajax],[ajax-ignore]')\n  if (root.hasAttribute('ajax-ignore')) return false\n  return el.tagName === 'FORM' ? true : isLocalLink(el);\n}\n\nasync function makeAjaxRequest(el, target) {\n  if (el.hasAttribute('ajax-confirm') && !confirm(el.getAttribute('ajax-confirm'))) return;\n\n  dispatch(el, 'ajax:before')\n\n  try {\n    let fragment = await requestFragment(requestOptionsFromElement(el))\n\n    target.replaceWith(fragment?.getElementById(target.id) ?? '')\n    dispatch(el, 'ajax:success')\n  } catch (error) {\n    dispatch(el, 'ajax:error', error)\n  }\n\n  dispatch(el, 'ajax:after')\n}\n\nfunction dispatch(el, name, detail = {}) {\n  el.dispatchEvent(\n      new CustomEvent(name, {\n          detail,\n          bubbles: true,\n          composed: true,\n          cancelable: true,\n      })\n  )\n}\n\nfunction requestOptionsFromElement(el) {\n  let defaults = {\n    action: window.location.href,\n    method: 'GET',\n  }\n\n  return {\n    action: el.getAttribute(isLocalLink(el) ? 'href' : 'action') || defaults.action,\n    data: el.tagName === 'FORM' ? new FormData(el) : new FormData(),\n    method: (el.getAttribute('method') || defaults.method).toUpperCase(),\n  }\n}\n\nfunction isLocalLink(el) {\n  return el.tagName === 'A' &&\n    location.hostname === el.hostname &&\n    el.getAttribute('href') &&\n    el.getAttribute('href').indexOf(\"#\") !== 0\n}\n\nasync function requestFragment(options) {\n  let response = ''\n  try {\n    response = await request(options.method, options.action, options.data, options)\n  } catch (response) {\n    throw Error(response.xhr.statusText)\n  }\n\n  return htmlToFragment(response)\n}\n\nfunction htmlToFragment(html) {\n  return document.createRange().createContextualFragment(html);\n}\n","import ajax from '../src/index'\n\ndocument.addEventListener('alpine:initializing', () => {\n    ajax(window.Alpine)\n})\n"],"names":["request","method","url","data","options","params","Array","from","entries","filter","key","value","length","splitUrl","split","anchor","includes","URLSearchParams","Promise","resolve","reject","xhr","XMLHttpRequest","open","overrideMimeType","headers","Object","assign","setRequestHeader","progress","upload","addEventListener","info","onload","status","response","onerror","send","Alpine","addRootSelector","directive","el","expression","cleanup","target","document","getElementById","id","Error","listeners","map","event","listenForAjaxEvent","forEach","remove","name","handler","source","getSourceElement","isValidSourceElement","preventDefault","makeAjaxRequest","removeEventListener","trigger","validTag","submit","click","closest","root","hasAttribute","tagName","isLocalLink","confirm","getAttribute","dispatch","fragment","requestFragment","requestOptionsFromElement","replaceWith","error","detail","dispatchEvent","CustomEvent","bubbles","composed","cancelable","defaults","action","window","location","href","FormData","toUpperCase","hostname","indexOf","statusText","htmlToFragment","html","createRange","createContextualFragment","ajax"],"mappings":"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"}